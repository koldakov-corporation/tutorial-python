[![en](https://img.shields.io/badge/lang-en-blue.svg)](/lessons/getting_started/first_program.md)
[![ru](https://img.shields.io/badge/lang-ru-green.svg)](/lessons/getting_started/first_program.ru.md)

[Домой](https://github.com/koldakov-corporation/tutorial/blob/main/README.ru.md)

[В начало Python руководства](/README.ru.md)

# Виртуальное окружение

Из прошлой главы Вы узнали, что рано или поздно для работы вам понадобятся различные библиотеки.
Но что, если Вы работаете на одном компьютере над несколькими разными проектами, которые требуют
различные версии одной и той же библиотеки?

Чтобы ответить на этот вопрос надо понять, как работает установка пакетов и что такое pip.

Pip - это менеджер пакетов для Python. С помощью pip вы можете установить
необходимый пакет: `pip install numpy` или удалить необходимый пакет `pip uninstall numpy`.

Но возникает вопрос, куда это библиотека будет установлена? В Unix системах существует три варианта:
1. Глобально: `sudo pip install numpy`
2. Локально: `pip install numpy`
3. В виртуальное окружение

1 Вариант категорически не рекомендуется, так как это может сломать права доступа, а так же этот способ
может привести к конфликтам в библиотеках.

2 Вариант использовать не стоит, потому что вы не сможете использовать разные версии для разных проектов.

3 Вариант - это самый правильный способ. Давайте разберёмся как это работает. Чтобы создать виртуальное
окружение, зайдите в директорию с проектом, например my-awesome-project, который Вы создавали ранее.
И создайте виртуальное окружение: `python -m venv .venv` (Или `python3 -m venv .venv`).
Виртуальное окружение создано в директорию `.venv`.

Эта команда не устанавливает новый Python, а всего лишь "линкует" существующий Python в виртуальное окружение.
Вы можете убедиться в этом, командой: `ls -l .venv/bin/python`, скорее всего, вывод будет: `python3`,
то есть надо посмотреть `ls -l .venv/bin/python3`, что выведет что-то вроде
`.venv/bin/python3 -> /usr/local/bin/python3`. То есть получается, что python ссылается на pyhon3,
а python3 в свою очередь ссылается на `/usr/local/bin/python3`.

Теперь, чтобы виртуальное окружение стало активным Вам необходимо активировать его. Это сделать
Вы можете командой `source .venv/bin/activate`. Если окружение успешно активировано, вы увидите
название окружение слева от своего ника: `(.venv)`.

После активации виртуального окружения Вы можете устанавливать библиотеки в это виртуальное окружение.
Попробуйте активировать окружение и установить любую библиотеку, например `numpy`:

1. `source .venv/bin/activate`
2. `pip install numpy`
3. `echo "import numpy; print(numpy.__version__)" | python` - так вы можете вывести версию numpy и что библиотека
установлена корректна

Все библиотеки будут установлены в директорию: `.venv/lib64/python3.12/site-packages/`
(или `.venv/lib/python3.12/site-packages/`).

Видите в чём преимущества? Теперь в зависимости от проекта Вы можете использовать разные версии
библиотек. Более того, Вы можете переустанавливать библиотеки, что бывает порой очень важно, если
возникают проблемы с зависимостями.

Деактивировать виртуальное окружение Вы можете с помощью команды: `deactivate`.

## Переменные виртуального окружения

Довольно часто, возникает необходимость хранить переменные "Вне кода".
Представьте такую ситуацию: Вы работаете над проектом с открытым исходным кодом, но вам надо
написать функционал, который будет шифровать текст со статическим ключом.

Так как код может посмотреть любой желающий, то нецелесообразно хранить пароль в коде - любой человек
сможет расшифровывать сообщения!

Уточню, что даже если код не с открытым исходным кодом, то хранить пароли в коде категорически не рекомендуется.
Другими словами не рекомендуется хардкодить (от англ. hard code, т.е. строго зашивать значения). Обычно
даже разработчики не имеют доступа до секретных значений, достигается это разными способами, такими как KMS -
секретными хранилищами.

Вернёмся к переменным окружения. Создать (т.е. экспортировать) такую переменную вы можете с помощью команды:
`export SECRET_VALUE=secret-value`, где `SECRET_VALUE` - это название переменной,
а `secret-value` -значение. Переменные обычно называют заглавными буквами с подчёркиваниями.
Также можно перед названием нередко пишут сокращённое название проекта, например, в нашем случае
переменную можно было бы назвать `MAP_SECRET_VALUE`, где
MAP - My Awesome Project, это сделано для того, чтобы не было конфликтом
с уже существующими переменными виртуального окружения.

Посмотреть все экспортированные переменные можно командой `export`.

После того как мы экспортировали переменную, мы можем получить его через Python.
Этого можно добиться с помощью built-in модуля "os":

```python
import os

os.environ["MAP_SECRET_VALUE"]
```

## Задача

Создайте проект с виртуальным окружением, который читает переменную `MAP_SECRET_VALUE` и выводит её значение.

## Заключение

Сегодня Вы научились создавать виртуальное окружение и поняли зачем это надо.
Также, вы поняли что такое переменные виртуального окружения.

Поздравляю! Все подготовки закончены и мы можем приступать непосредственно к кодингу!

## Навигация

[Предыдущая глава](/lessons/getting_started/imports.ru.md)
